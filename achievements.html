<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è | EduFlow</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="dashboard-container">

    <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
    <div class="sidebar">
        <h2>EduFlow</h2>
        <ul>
            <li><a href="dashboard.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
            <li><a href="courses.html">–ú–æ–∏ –∫—É—Ä—Å—ã</a></li>
            <li><a href="tasks.html">–ó–∞–¥–∞–Ω–∏—è</a></li>
            <li><a href="stats.html">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a></li>
            <li class="premium-only"><a href="feedback.html">–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</a></li>
            <li><a href="settings.html">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a></li>
        </ul>
        <ul style="margin-top: auto;">
            <li><a href="#" id="logoutBtn">–í—ã–π—Ç–∏</a></li>
        </ul>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="content">
        <h1>–í–∞—à–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h1>

        <div class="cards" id="badgesList">
            <div class="card-box">
                <h3>üèÜ –ù–∞—á–∏–Ω–∞—é—â–∏–π</h3>
                <p>–í—ã –Ω–∞–±—Ä–∞–ª–∏ 100 –æ—á–∫–æ–≤</p>
            </div>
            <div class="card-box">
                <h3>üöÄ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π</h3>
                <p>–í—ã –Ω–∞–±—Ä–∞–ª–∏ 250 –æ—á–∫–æ–≤</p>
            </div>
            <div class="card-box">
                <h3>üéì –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª</h3>
                <p>–í—ã –Ω–∞–±—Ä–∞–ª–∏ 500 –æ—á–∫–æ–≤</p>
            </div>
        </div>

        <div class="card-box">
            <h3>–¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</h3>
            <ol id="leaderboard"></ol>
        </div>
    </div>

</div>

<script>
    
    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const currentUserEmail = localStorage.getItem('eduflowCurrentUser');

if (!currentUserEmail) {
    alert("–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã");
    window.location.href = "index.html";
    exit;
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const userDataString = localStorage.getItem(`eduflowUser_${currentUserEmail}`);
if (!userDataString) {
    alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö");
    window.location.href = "index.html";
    exit;
}

const user = JSON.parse(userDataString);

// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∞—Ä–∏—Ñ
if (user.plan !== "premium") {
    if (confirm("–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ç–∞—Ä–∏—Ñ–æ–º Premium. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é?")) {
        window.location.href = "dashboard.html";
    } else {
        document.body.innerHTML = `
            <div style="padding: 40px; text-align: center;">
                <h2>–î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω</h2>
                <p>–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ç–∞—Ä–∏—Ñ–æ–º Premium.</p>
                <a href="dashboard.html" class="btn">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
            </div>
        `;
    }
}

    // –õ–∏–¥–µ—Ä–±–æ—Ä–¥
    function updateLeaderboard() {
        const allUsers = {};
        for (let key in localStorage) {
            if (key.startsWith("eduflowUser_")) {
                const email = key.replace("eduflowUser_", "");
                const data = JSON.parse(localStorage.getItem(key));
                const points = parseInt(localStorage.getItem(`eduflowPoints_${email}`)) || 0;
                allUsers[email] = { ...data, points };
            }
        }

        const usersArray = Object.values(allUsers);
        usersArray.sort((a, b) => b.points - a.points);

        const leaderboard = document.getElementById("leaderboard");
        leaderboard.innerHTML = "";

        usersArray.forEach((u, index) => {
            const li = document.createElement("li");
            li.textContent = `${u.email} ‚Äî ${u.points} –æ—á–∫–æ–≤`;
            leaderboard.appendChild(li);
        });
    }

    updateLeaderboard();

    // –°–∫—Ä—ã—Ç–∏–µ –ø—Ä–µ–º–∏—É–º-—Ä–∞–∑–¥–µ–ª–æ–≤ –≤ –º–µ–Ω—é
const premiumOnlyLinks = document.querySelectorAll(".premium-only");

if (user.plan !== "Premium") {
    premiumOnlyLinks.forEach(link => link.style.display = "none");
}
</script>
<script src="auth.js"></script>
</body>
</html>